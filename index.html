<html ng-app="photoSharingApp">
<head>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<link rel="stylesheet" type="text/css" href="css/app.css">
	<script type="text/javascript" src="angular.min.js"></script>
	<script type="text/javascript" src="angular-route.min.js"></script> 
	<script type="text/javascript" src="bootstrap.min.js"></script> 
</head>
<body>
	<ng-view></ng-view> 

	<script type="text/javascript">
		var photoApp = angular.module("photoSharingApp", [ "ngRoute" ]);
	// setup routing
	photoApp.config(function($routeProvider){
		$routeProvider
		.when("/albums", {controller: "AlbumListController", templateUrl: "album_list_partial.html"})
		.when("/",{redirectTo: "/albums"})
		.when("/404_page", {controller: "Controller404", templateUrl: "404_page_partial.html"})
		.otherwise({redirectTo: "/404_page"});

	});	

	function AlbumListController($scope){
		$scope.adding_album={};
		$scope.add_album_error="";
		$scope.albumNames=[
		{name:'Madrid',title:'Weekend in Madrid',date:'12.03.2014', describtion: 'At Madrid'},
		{name:'London',title:'Weekend in London',date:'11.06.2013',describtion: 'At London'},
		{name:'Berlin',title:'Weekend in Berlin',date:'23.05.2011',describtion: 'Berlin'},
		{name:'Bkk',title:'Weekend in Bkk',date:'21.09.2012',describtion: 'At Bangkok'},
		{name:'Paris',title:'Weekend in Paris',date:'16.09.2014',describtion: 'At Paris'}

		];

		//model
		$scope.addAlbum= function (new_album){
			// form validation
			if(!new_album.title)
				$scope.add_album_error="Missing title";
			else if (!new_album.date ||  !is_valid_date(new_album.date))
				$scope.add_album_error="Date incorrect";
			else if(!new_album.describtion)
				$scope.add_album_error="Missing description";
			else if(!new_album.name)
				$scope.add_album_error="Missing short name";
			else
			{
				$scope.albumNames.push(new_album);
				$scope.adding_album={};
				$scope.add_album_error="";
			}
		};

	}


	function is_valid_date(the_date){
		if(the_date.match(/[0-9]{2,4}\.[0-9]{1,2}\.[0-9]{1,2}/)){
			var d = new Date(the_date);
			return !isNaN(d.getTime());			
		}
		else{ 
			return false;
		}	
	}

	photoApp.controller("AlbumListController", AlbumListController);

</script>

</body>
</html>